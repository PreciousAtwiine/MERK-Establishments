{% extends 'base.html' %}

{% block title %}Sales{% endblock %}

{% block extra_css %}
<style>
    .stat-chip { padding: .5rem .75rem; border: 1px solid rgba(124, 58, 237, .25); border-radius: .75rem; background: #f3e8ff; }
    .stat-chip .label { color: #000000; font-size: .85rem; }
    .stat-chip .value { font-weight: 700; color: #000000; }
    .table thead th { position: sticky; top: 0; background: #f8fafc; z-index: 1; }
    .empty-state { border: 1px dashed rgba(2,6,23,.15); border-radius: 1rem; background: #ffffff; }
    @media (prefers-color-scheme: dark) {
        /* Keep stat chips lilac and text black in dark mode */
        .stat-chip { background: #f3e8ff; border-color: rgba(124,58,237,.35); }
        .stat-chip .label { color: #0c0c0c; }
        /* For text */
        .stat-chip .value { color: #000000; }
        /* For table header */
        .table thead th { background: #f0cfe8; }
        /* Keep the Add Sale area light even in dark mode */
        .empty-state { background: #ffffff; border-color: rgba(225, 228, 238, 0.772); color: #000000d0; }
    }
</style>
{% endblock %}

{% block header %}Sales Records{% endblock %}

{% block header_buttons %}
<a href="{% url 'home:add_sale' %}" class="btn btn-primary">
    <i class="fas fa-plus me-2"></i>Add New Sale
    </a>
{% endblock %}

{% block content %}
<div class="row g-3 mb-4">
    <div class="col-auto">
        <div class="stat-chip">
            <div class="label">Total Sales</div>
            <div class="value">{{ total_sales }}</div>
        </div>
    </div>
    <div class="col-auto">
        <div class="stat-chip">
            <div class="label">Records</div>
            <div class="value">{{ sales|length }}</div>
        </div>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body p-0">
        {% if sales %}
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th class="text-nowrap">Sale ID</th>
                        <th>Product</th>
                        <th class="text-end">Quantity</th>
                        <th class="text-end">Unit Price</th>
                        <th class="text-nowrap">Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sale in sales %}
                    <tr>
                        <td class="text-muted">{{ sale.id }}</td>
                        <td>{{ sale.product_name }}</td>
                        <td class="text-end">{{ sale.quantity }}</td>
                        <td class="text-end">UGX.{{ sale.unit_price }}</td>
                        <td>{{ sale.date|date:"Y-m-d" }}</td>
                        <td class="text-nowrap">
                            <a href="{% url 'home:edit_sale' sale.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
                            <form method="post" action="{% url 'home:delete_sale' sale.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this sale?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="p-5 text-center empty-state">
            <h5 class="mb-2">No sales records found</h5>
            <p class="text-secondary mb-4">Get started by adding your first sale.</p>
            <a href="{% url 'home:add_sale' %}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Add Sale
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}