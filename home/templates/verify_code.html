{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Code</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
    <div class="container" style="max-width: 480px;">
        <h4 class="mb-3">Enter the code</h4>
        <form method="post" action="{% url 'home:verify_code' %}">
            {% csrf_token %}
            {{ form|crispy }}
            <button class="btn btn-primary w-100" type="submit">Verify & Sign in</button>
        </form>
        <p class="text-muted mt-3 small">Codes expire after 5 minutes.</p>
        <p class="mt-1 small">Time remaining: <span id="countdown">05:00</span></p>
    </div>
    <script>
    (function(){
        var total = Number('{{ expires_in_seconds|default:"300" }}'); // seconds
        var countdownEl = document.getElementById('countdown');
        var form = document.querySelector('form');
        function tick(){
            var m = Math.floor(total / 60);
            var s = total % 60;
            countdownEl.textContent = (m < 10 ? '0' + m : m) + ':' + (s < 10 ? '0' + s : s);
            if (total <= 0){
                countdownEl.textContent = '00:00';
                if (form){
                    var btn = form.querySelector('button[type="submit"]');
                    if (btn){ btn.disabled = true; btn.textContent = 'Code expired'; }
                }
                return;
            }
            total -= 1;
            setTimeout(tick, 1000);
        }
        tick();
    })();
    </script>
</body>
</html>


